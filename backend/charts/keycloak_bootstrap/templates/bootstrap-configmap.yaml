apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "keycloak-bootstrap.fullname" . }}-cm
  labels:
    chart: "{{ $.Chart.Name }}-{{ $.Chart.Version }}"
    release: "{{ $.Release.Name }}"
    heritage: "{{ $.Release.Service }}"
data:
  entitlements.json: |
    {
      {{- range $k, $v := $.Values.entitlement.preloadedClaims }}
      {{ if ne $k 0 }},{{ end }}"{{ $v.id }}": {
        "subject_attributes":[
        {{- range $attr, $attrvalue := $v.attributes }}
        {{ if ne $attr 0 }},{{ end }}{"attribute": "{{ $attrvalue }}"}
        {{- end }}
        ]
      }
      {{- end }}
    }
