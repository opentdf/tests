import {expect, test} from "@playwright/test";
import {constants} from "http2";

// @ts-ignore
const {platform_url} = JSON.parse(process.env.SERVER_DATA);

test(' Anti-clickjacking header test', async ({request}) => {
    const response = await request.get(`${platform_url}/healthz`, {});
    expect(response.status()).toBe(constants.HTTP_STATUS_OK);
    const headers = response.headers();
    // console.log(headers);
    expect(headers['content-security-policy']).toBeTruthy();
    expect(headers['content-security-policy']).toContain('frame-ancestors');
});

test('X-Content-Type-Options Header header test', async ({request}) => {
    const response = await request.get(`${platform_url}/healthz`, {});
    expect(response.status()).toBe(constants.HTTP_STATUS_OK);
    const headers = response.headers();

    expect(headers['x-content-type-options']).toBeTruthy();
    expect(headers['x-content-type-options']).toContain('nosniff');
});

// test('Server Leaks Information via "X-Powered-By" HTTP Response Header Field header test', async ({request}) => {
//     const response = await apiContext.get(`${authority}`, {});
//     expect(response.status()).toBe(constants.HTTP_STATUS_OK);
//     const headers = response.headers();
//
//     expect(headers['X-Powered-By']).toBeFalsy();
// });
