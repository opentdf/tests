include('../projects/backend/Tiltfile.xtest')

k8s_resource("kas", resource_deps=["attributes"], port_forwards="8000:8000")
k8s_resource("keycloak", port_forwards="8080:8080")
k8s_resource(
    "opentdf-xtest",
    resource_deps=["keycloak-bootstrap", "keycloak", "kas"],
    auto_init=False,
    trigger_mode=TRIGGER_MODE_MANUAL
)

local_resource(
    "test-client-web",
    "npm run test",
    resource_deps=["keycloak", "keycloak-bootstrap", "kas"]
)

local_resource(
    "frontend-test",
    "CI=true npm run test:playwright",
    dir="../projects/frontend",
    resource_deps=["keycloak", "keycloak-bootstrap", "kas"]
)
